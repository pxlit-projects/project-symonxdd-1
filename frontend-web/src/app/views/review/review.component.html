<div class="review-container">
  <!-- Header -->
  <mat-toolbar color="primary" class="header-toolbar">
    <span>Review Posts</span>
  </mat-toolbar>

  <!-- Error Message -->
  @if(errorMessage) {
  <div class="error-message">
    <mat-icon>error</mat-icon>
    <p>{{ errorMessage }}</p>
  </div>
  }

  <!-- Post List -->
  @if(unpublishedPosts.length > 0){
  @for (post of unpublishedPosts; track post.id) {
  <div class="post-card">
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{ post.title }}</mat-card-title>
        <mat-card-subtitle>By: {{ post.author }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p>{{ post.content }}</p>
        <p>
          Status:
          <strong><span [class.pending]="post.status === 'PENDING_REVIEW'"
              [class.rejected]="post.status === 'REJECTED'">
              {{ post.status }}
            </span></strong>
        </p>
      </mat-card-content>

      @if (post.id) {
      <mat-card-actions>
        <!-- For Rejected Posts -->
        @if (post.status === 'REJECTED') {
        <form #rejectedForm="ngForm" (ngSubmit)="approvePost(post.id)">
          <button mat-raised-button color="primary" type="submit">Approve</button>
        </form>
        }

        <!-- For Pending Review Posts -->
        @if(post.status === 'PENDING_REVIEW') {
        <form #pendingForm="ngForm">
          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="approvePost(post.id)">Approve</button>
            <button mat-raised-button color="warn" type="button"
              (click)="rejectPost(post.id!, comments[post.id!], pendingForm)">
              Reject
            </button>
          </div>
          <mat-form-field appearance="outline">
            <mat-label>Comment</mat-label>
            <input matInput name="comment" placeholder="Comment" [(ngModel)]="comments[post.id!]"
              #commentInput="ngModel" required />

            @if(commentInput.invalid && commentInput.touched) {
            <mat-error>
              You forgot to write a comment...
            </mat-error>
            }

          </mat-form-field>
        </form>
        }
      </mat-card-actions>}

    </mat-card>
  </div>
  }
  }

  <!-- No Posts -->
  @if (unpublishedPosts.length === 0) {
  <div class="no-posts">
    <mat-icon>inbox</mat-icon>
    <p>No posts to review.</p>
  </div>
  }
</div>